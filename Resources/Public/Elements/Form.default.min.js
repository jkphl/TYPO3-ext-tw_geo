!function(n){var e=function(){this.elements=[].slice.call(n.querySelectorAll(".Geoselect"),0).map(function(t){return new i(t)})},i=function(t){return this.container=t||null,this.container&&this.container.id?(this.search=n.getElementById(this.container.id+"-search"),this.latLon=n.getElementById(this.container.id+"-lat-lon"),this.search&&this.latLon?(this.position=n.getElementById(this.container.id+"-position"),this.submit=n.getElementById(this.container.id+"-submit"),this.map=null,this.initAutocomplete(),this.initMap(),void this.onInitialize()):null):null};i.prototype.initAutocomplete=function(){this.searchAutocomplete=new google.maps.places.Autocomplete(this.search),this.searchAutocomplete.addListener("place_changed",this.handle_autocompletePlaceChanged.bind(this)),function(t,e){for(;(t=t.parentElement)&&t.tagName!=e.toLowerCase()&&t.tagName!=e.toUpperCase(););return t}(this.search,"form").addEventListener("submit",function(t){n.activeElement==this.search&&t.preventDefault()}.bind(this)),this.search.addEventListener("change",function(t){t.currentTarget.value||this.reset()}.bind(this))},i.prototype.initMap=function(){var t=n.getElementById(this.container.id+"-map");if(!t)return!1;var e={lat:Number(t.attributes["data-latitude"].value),lng:Number(t.attributes["data-longitude"].value)};if(this.map=new google.maps.Map(t,{zoom:6,center:e,streetViewControl:!1,rotateControl:!1,fullscreenControl:!1,mapTypeControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},styles:[{featureType:"poi",elementType:"labels.icon",stylers:[{color:"#9d9d9d"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#9d9d9d"}]}]}),this.container.attributes["data-lat-lon"]){var i=this.container.attributes["data-lat-lon"].value.split(",");e={lat:Number(i[0]),lng:Number(i[1])};this.setLatLon(Number(i[0]),Number(i[1]))}},i.prototype.onInitialize=function(){this.position&&this.position.parentNode.removeChild(this.position),this.submit&&this.submit.parentNode.removeChild(this.submit),this.container.classList.add("Geoselect--js"),this.container.twGeoselect=this},i.prototype.handle_autocompletePlaceChanged=function(t){var e=this.searchAutocomplete.getPlace();if(!e||!e.geometry)return this.container.removeAttribute("data-lat-lon"),null;var i=e.geometry.location.lat(),n=e.geometry.location.lng();this.container.setAttribute("data-lat-lon",i+","+n),this.setLatLon(i,n)},i.prototype.setLatLon=function(t,e){if(this.latLon.value=t+","+e,this.marker)this.marker.setPosition({lat:t,lng:e});else{var i=this.map.getDiv().attributes["data-marker"];if(i=i?i.value:null)var n={url:i,size:new google.maps.Size(48,68),scaledSize:new google.maps.Size(32,45),anchor:new google.maps.Point(12,34)};this.marker=new google.maps.Marker({position:{lat:t,lng:e},map:this.map,icon:n})}this.map.setCenter({lat:t,lng:e}),this.map.setZoom(17),this.container.dispatchEvent(new CustomEvent("geoselect_change",{detail:{latitude:t,longitude:e}}))},i.prototype.reset=function(){if(this.marker){this.marker.setMap(null),this.marker=null;var t=n.getElementById(this.container.id+"-map"),e={lat:Number(t.attributes["data-latitude"].value),lng:Number(t.attributes["data-longitude"].value)}}this.map.setCenter(e),this.map.setZoom(6),this.latLon.value&&(this.latLon.value=""),this.search.value&&(this.search.value=""),this.container.removeAttribute("data-lat-lon"),this.container.dispatchEvent(new CustomEvent("geoselect_change",{detail:{}}))},i.prototype.addMyLocationControl=function(){if(!navigator.geolocation)return!1;var t=n.createElement("div");t.innerHTML=n.getElementById("GoogleMap-MyLocation").innerHTML,t.index=1,t.addEventListener("click",function(t){navigator.geolocation.getCurrentPosition(function(t){this.setLatLon(t.coords.latitude,t.coords.longitude),this.search.value=t.coords.latitude+","+t.coords.longitude,this.map.setZoom(14)}.bind(this))}.bind(this)),this.map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(t)},n.addEventListener("DOMContentLoaded",function(t){new e})}(document);