!function(i){function n(t){this.elements=[].slice.call(t).map(function(t){return new o(t)})}function o(t){return this.container=t||null,this.container&&this.container.id?(this.search=i.getElementById(this.container.id+"-search"),this.latLon=i.getElementById(this.container.id+"-lat-lon"),this.search&&this.latLon?(this.position=i.getElementById(this.container.id+"-position"),this.submit=i.getElementById(this.container.id+"-submit"),this.initAutocomplete(),this.map=this.initMap(),void this.onInitialize()):null):null}o.prototype.initAutocomplete=function(){this.searchAutocomplete=new google.maps.places.Autocomplete(this.search,{componentRestrictions:{country:this.container.hasAttribute("data-restrict-countries")?String(this.container.getAttribute("data-restrict-countries")).split(",").map(function(t){return t.trim()}):[]}}),this.searchAutocomplete.addListener("place_changed",this.handle_autocompletePlaceChanged.bind(this)),function(t,e){for(;(t=t.parentElement)&&t.tagName!=e.toLowerCase()&&t.tagName!=e.toUpperCase(););return t}(this.search,"form").addEventListener("submit",function(t){i.activeElement==this.search&&t.preventDefault()}.bind(this)),this.search.addEventListener("change",function(t){t.currentTarget.value||this.reset()}.bind(this))},o.defaultStyles=[{featureType:"poi",elementType:"labels.icon",stylers:[{color:"#9d9d9d"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#9d9d9d"}]}],o.prototype.initMap=function(){var t=i.getElementById(this.container.id+"-map");if(!t)return null;var e=this.container.hasAttribute("data-lat-lon")?this.container.attributes["data-lat-lon"].value.split(","):[];return new google.maps.Map(t,{zoom:12,center:{lat:Number(2===e.length?e[0]:t.attributes["data-latitude"].value),lng:Number(2===e.length?e[1]:t.attributes["data-longitude"].value)},streetViewControl:!1,rotateControl:!1,fullscreenControl:!1,zoomControl:!1,mapTypeControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},styles:window.googleMapStyles?window.googleMapStyles:o.defaultStyles})},o.prototype.onInitialize=function(){this.position&&this.position.parentNode.removeChild(this.position),this.container.classList.add("Geoselect--js"),this.container.geoselect=this},o.prototype.handle_autocompletePlaceChanged=function(t){var e=this.searchAutocomplete.getPlace();if(!e||!e.geometry)return this.container.removeAttribute("data-lat-lon"),null;var i=e.geometry.location.lat(),n=e.geometry.location.lng();this.container.setAttribute("data-lat-lon",i+","+n),this.setLatLon(i,n)},o.prototype.setLatLon=function(t,e){if(this.latLon.value=t+","+e,this.map){if(this.marker)this.marker.setPosition({lat:t,lng:e});else{var i=this.map.getDiv().attributes["data-marker"];i=i?i.value:null,this.marker=new google.maps.Marker({position:{lat:t,lng:e},map:this.map,icon:i?{url:i,size:new google.maps.Size(48,68),scaledSize:new google.maps.Size(32,45),anchor:new google.maps.Point(12,34)}:null})}alert("setCenter: "+t+" - "+e),this.map.setCenter({lat:t,lng:e}),this.map.setZoom(17)}this.container.dispatchEvent(new CustomEvent("geoselect_change",{detail:{latitude:t,longitude:e}}))},o.prototype.reset=function(){if(this.marker){this.marker.setMap(null),this.marker=null;var t=i.getElementById(this.container.id+"-map");this.map.setCenter({lat:Number(t.attributes["data-latitude"].value),lng:Number(t.attributes["data-longitude"].value)})}this.map.setZoom(6),this.latLon.value&&(this.latLon.value=""),this.search.value&&(this.search.value=""),this.container.removeAttribute("data-lat-lon"),this.container.dispatchEvent(new CustomEvent("geoselect_change",{detail:{}}))},o.prototype.addMyLocationControl=function(){if(!navigator.geolocation)return!1;var t=i.createElement("div");t.innerHTML=i.getElementById("GoogleMap-MyLocation").innerHTML,t.index=1,t.addEventListener("click",function(t){navigator.geolocation.getCurrentPosition(function(t){this.setLatLon(t.coords.latitude,t.coords.longitude),this.search.value=t.coords.latitude+","+t.coords.longitude,this.map.setZoom(14)}.bind(this))}.bind(this)),this.map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(t)},i.addEventListener("DOMContentLoaded",function(t){var e=i.querySelectorAll(".Geoselect");e.length&&new n(e)})}(document);
//# sourceMappingURL=tw_geo-default.min.js.map
